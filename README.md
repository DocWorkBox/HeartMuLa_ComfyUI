# HeartMuLa ComfyUI (ä¸­æ–‡ä¼˜åŒ–ç‰ˆ)

è¿™æ˜¯ä¸€ä¸ªä¸º [ComfyUI](https://github.com/comfyanonymous/ComfyUI) å¼€å‘çš„è‡ªå®šä¹‰èŠ‚ç‚¹æ’ä»¶ï¼Œç”¨äºæ”¯æŒ **HeartMuLa** éŸ³ä¹ç”Ÿæˆæ¨¡å‹å’Œæ­Œè¯è½¬å½•åŠŸèƒ½ã€‚

æœ¬é¡¹ç›®åŸºäº [benjiyaya/HeartMuLa_ComfyUI](https://github.com/benjiyaya/HeartMuLa_ComfyUI) è¿›è¡ŒäºŒæ¬¡å¼€å‘ï¼Œå¹¶åœ¨åŸé¡¹ç›®åŸºç¡€ä¸Šè¿›è¡Œäº†æ·±åº¦ä¼˜åŒ–ï¼Œä½¿å…¶èƒ½å¤Ÿåœ¨æ¶ˆè´¹çº§æ˜¾å¡ï¼ˆä½è‡³ 12GB VRAM ç”šè‡³æ›´ä½ï¼‰ä¸Šæµç•…è¿è¡Œã€‚

## ğŸµ åŠŸèƒ½ç‰¹ç‚¹ä¸ä¼˜åŒ–

ä¸ºäº†è§£å†³åŸç‰ˆæ’ä»¶ä¸­æ˜¾å­˜å ç”¨è¿‡é«˜çš„é—®é¢˜ï¼Œæˆ‘ä»¬è¿›è¡Œäº†ä»¥ä¸‹å…³é”®æ”¹è¿›ï¼š

1.  **æ¨¡å—åŒ–èŠ‚ç‚¹è®¾è®¡**:
    *   æˆ‘ä»¬å°†åŸæœ¬è€¦åˆåœ¨ä¸€èµ·çš„å•ä½“èŠ‚ç‚¹æ‹†åˆ†ä¸ºç‹¬ç«‹çš„**åŠ è½½å™¨ (Loaders)** å’Œ **ç”Ÿæˆå™¨ (Generator/Transcriptor)**ã€‚
    *   ç”¨æˆ·å¯ä»¥çµæ´»ç»„åˆï¼Œä»…åŠ è½½éœ€è¦çš„æ¨¡å‹éƒ¨åˆ†ã€‚

2.  **ä½æ˜¾å­˜ä¼˜åŒ– (Low VRAM Support)**:
    *   å®ç°äº†æ™ºèƒ½æ˜¾å­˜ç®¡ç†ç­–ç•¥ã€‚åœ¨å¼€å¯ `Low VRAM Mode`ï¼ˆé»˜è®¤å¼€å¯ï¼‰æ—¶ï¼Œæ¨¡å‹å¹³æ—¶é©»ç•™åœ¨ CPU å†…å­˜ä¸­ã€‚
    *   ä»…åœ¨ç”Ÿæˆ/æ¨ç†çš„ç¬é—´å°†å½“å‰éœ€è¦çš„æ¨¡å‹ï¼ˆå¦‚ Transformer æˆ– Codecï¼‰ç§»åŠ¨åˆ° GPUï¼Œæ¨ç†å®Œæˆåç«‹å³é‡Šæ”¾æ˜¾å­˜ã€‚
    *   è¿™ä½¿å¾— 3B ç‰ˆæœ¬çš„æ¨¡å‹å¯ä»¥åœ¨ **12GB æ˜¾å­˜** çš„è®¾å¤‡ä¸Šè¿è¡Œï¼Œç”šè‡³æ›´ä½é…ç½®çš„è®¾å¤‡ä¹Ÿèƒ½å°è¯•ã€‚

3.  **è‡ªåŠ¨æ¨¡å‹ä¸‹è½½**:
    *   æ— éœ€æ‰‹åŠ¨ä¸‹è½½ç¹ççš„æ¨¡å‹æ–‡ä»¶ã€‚é¦–æ¬¡è¿è¡Œæ—¶ï¼Œæ’ä»¶ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶ä» HuggingFace å®˜æ–¹ä»“åº“ä¸‹è½½æ‰€éœ€çš„æ¨¡å‹æƒé‡åˆ° `ComfyUI/models/HeartMuLa` ç›®å½•ã€‚

4.  **çµæ´»çš„è®¾å¤‡åŠ è½½é€‰é¡¹**:
    *   åŠ è½½å™¨èŠ‚ç‚¹æä¾›äº† `load_device` é€‰é¡¹ã€‚
    *   **CPU**: èŠ‚çœæ˜¾å­˜ï¼Œé€‚åˆå°æ˜¾å­˜æ˜¾å¡ã€‚
    *   **CUDA**: ç›´æ¥åŠ è½½åˆ°æ˜¾å­˜ï¼Œé€‚åˆ 24GB+ å¤§æ˜¾å­˜è®¾å¤‡ï¼Œç”Ÿæˆé€Ÿåº¦æ›´å¿«ã€‚

## ğŸ› ï¸ å®‰è£…æ–¹æ³•

1.  è¿›å…¥æ‚¨çš„ ComfyUI è‡ªå®šä¹‰èŠ‚ç‚¹ç›®å½•ï¼š
    ```bash
    cd ComfyUI/custom_nodes
    ```
2.  å…‹éš†æœ¬é¡¹ç›®ï¼š
    ```bash
    git clone https://github.com/benjiyaya/HeartMuLa_ComfyUI
    ```
3.  è¿›å…¥é¡¹ç›®ç›®å½•å¹¶å®‰è£…ä¾èµ–ï¼š
    ```bash
    cd HeartMuLa_ComfyUI
    pip install -r requirements.txt
    ```

## ğŸš€ ä½¿ç”¨è¯´æ˜

å¯åŠ¨ ComfyUI åï¼Œæ‚¨å¯ä»¥åœ¨èŠ‚ç‚¹åˆ—è¡¨ä¸­æ‰¾åˆ° `HeartMuLa` åˆ†ç±»ã€‚

### æ¨èå·¥ä½œæµ

![Workflow Example](workflow_example.png)

**éŸ³ä¹ç”Ÿæˆ (Music Generation):**
1.  æ·»åŠ  `HeartMuLa Model Loader` èŠ‚ç‚¹ï¼Œé€‰æ‹©ç‰ˆæœ¬ï¼ˆå¦‚ 3Bï¼‰ã€‚
2.  æ·»åŠ  `HeartCodec Loader` èŠ‚ç‚¹ã€‚
3.  æ·»åŠ  `HeartMuLa Music Generator` èŠ‚ç‚¹ã€‚
4.  å°†å‰ä¸¤ä¸ªèŠ‚ç‚¹çš„è¾“å‡ºè¿æ¥åˆ° Generator çš„å¯¹åº”è¾“å…¥ã€‚
5.  è¾“å…¥æ­Œè¯ (`lyrics`) å’Œæ ‡ç­¾ (`tags`)ï¼Œç‚¹å‡»è¿è¡Œå³å¯ã€‚

**æ­Œè¯è½¬å½• (Lyrics Transcription):**
1.  æ·»åŠ  `HeartTranscriptor Loader` èŠ‚ç‚¹ã€‚
2.  æ·»åŠ  `Load Audio` èŠ‚ç‚¹ï¼ˆComfyUI è‡ªå¸¦ï¼‰ã€‚
3.  æ·»åŠ  `HeartTranscriptor` èŠ‚ç‚¹ã€‚
4.  è¿æ¥æ¨¡å‹å’ŒéŸ³é¢‘è¾“å…¥ï¼Œç‚¹å‡»è¿è¡Œè·å–æ­Œè¯æ–‡æœ¬ã€‚

## ğŸ“– èŠ‚ç‚¹å‚æ•°è¯´æ˜ (Node Parameters)

### 1. HeartMuLa Music Generator (éŸ³ä¹ç”Ÿæˆ)
*   **max_audio_length_ms**: ç”ŸæˆéŸ³é¢‘çš„æœ€å¤§é•¿åº¦ï¼ˆæ¯«ç§’ï¼‰ã€‚ä¾‹å¦‚ `60000` ä»£è¡¨ 1 åˆ†é’Ÿã€‚
*   **topk**: é‡‡æ ·ç­–ç•¥å‚æ•°ï¼Œæ§åˆ¶ç”Ÿæˆçš„å¤šæ ·æ€§ã€‚
*   **temperature**: æ¸©åº¦å‚æ•°ï¼Œæ§åˆ¶ç”Ÿæˆçš„éšæœºæ€§ã€‚
*   **cfg_scale**: åˆ†ç±»å™¨è‡ªç”±å¼•å¯¼æ¯”ä¾‹ (Classifier-Free Guidance)ï¼Œæ§åˆ¶ç”Ÿæˆå†…å®¹å¯¹æç¤ºè¯çš„éµå¾ªç¨‹åº¦ã€‚
*   **control_seed**: æ§åˆ¶ç”Ÿæˆçš„ç§å­ï¼Œç”¨äºå¤ç°ç»“æœã€‚
*   **low_vram**: å¼€å¯ä½æ˜¾å­˜æ¨¡å¼ï¼ˆé»˜è®¤å¼€å¯ï¼‰ï¼Œç”Ÿæˆå®Œæ¯•åè‡ªåŠ¨é‡Šæ”¾æ˜¾å­˜ã€‚

### 2. HeartTranscriptor (æ­Œè¯è½¬å½•)
*   **max_new_tokens**: å•æ¬¡ç”Ÿæˆçš„æœ€å¤§ Token æ•°é‡ã€‚é»˜è®¤ä¸º `400`ã€‚
*   **language**: è¯­è¨€è®¾ç½®ã€‚é»˜è®¤ `auto` (è‡ªåŠ¨æ£€æµ‹)ï¼Œå¦‚æœè¯†åˆ«ä¸å‡†ç¡®ï¼ˆå¦‚å¼€å¤´æœ‰é•¿é™éŸ³å¯¼è‡´è¯¯åˆ¤ï¼‰ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¯¹åº”è¯­è¨€ï¼ˆå¦‚ `zh`ï¼‰ã€‚
*   **temperature**: é‡‡æ ·æ¸©åº¦ã€‚é»˜è®¤ä¸º `0.0` (æœ€ç¡®å®š)ï¼Œå¦‚æœè¯†åˆ«ç»“æœå¡ä½æˆ–é‡å¤ï¼Œå¯å°è¯•å¾®è°ƒè‡³ `0.2`ã€‚
*   **batch_size**: æ‰¹å¤„ç†å¤§å°ã€‚é»˜è®¤ä¸º `4`ã€‚æ˜¾å­˜è¾ƒå¤§æ—¶å¯è°ƒå¤§æ­¤å€¼ä»¥åŠ å¿«é€Ÿåº¦ã€‚
*   **chunk_length_s**: éŸ³é¢‘åˆ‡ç‰‡é•¿åº¦ï¼ˆç§’ï¼‰ã€‚é»˜è®¤ä¸º `30`ã€‚Whisper æ¨¡å‹æ ‡å‡†è¾“å…¥é•¿åº¦ã€‚
*   **stride_length_s**: åˆ‡ç‰‡é‡å æ­¥é•¿ï¼ˆç§’ï¼‰ã€‚é»˜è®¤ä¸º `5`ã€‚ç”¨äºè§£å†³é•¿éŸ³é¢‘åˆ‡ç‰‡è¾¹ç•Œçš„è¯†åˆ«é—®é¢˜ã€‚å¦‚æœæ­Œè¯åœ¨é—´å¥å¤„æ–­å¼€ï¼Œè¯·å°è¯•**è°ƒå¤§**æ­¤å€¼ï¼ˆå¦‚ `8` æˆ– `10`ï¼‰ã€‚
*   **no_speech_threshold**: é™éŸ³é˜ˆå€¼ã€‚é»˜è®¤ä¸º `0.4`ã€‚
*   **low_vram**: ä½æ˜¾å­˜æ¨¡å¼å¼€å…³ã€‚

## ğŸ“‚ æ¨¡å‹æ–‡ä»¶ç»“æ„

æ’ä»¶ä¼šè‡ªåŠ¨å¤„ç†æ¨¡å‹ä¸‹è½½ï¼Œé»˜è®¤ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š
```
ComfyUI/models/HeartMuLa/
â”œâ”€â”€ HeartMuLaGen/ (é…ç½®æ–‡ä»¶)
â”œâ”€â”€ HeartMuLa-oss-3B/ (ç”Ÿæˆæ¨¡å‹æƒé‡)
â”œâ”€â”€ HeartCodec-oss/ (éŸ³é¢‘ç¼–è§£ç æƒé‡)
â””â”€â”€ HeartTranscriptor-oss/ (è½¬å½•æ¨¡å‹æƒé‡)
```

## ï¿½ å…³æ³¨ä½œè€… (Follow Me)

*   **Bilibili**: [Doc_workBoxçš„ä¸ªäººç©ºé—´](https://b23.tv/ZEbk9dQ)
*   **YouTube**: [Docçš„å·¥å…·ç®±](https://youtube.com/@doc_workbox?si=pw2IrWob8D7nJYlH)

## ï¿½ğŸ™ è‡´è°¢ (Acknowledgements)

ç‰¹åˆ«æ„Ÿè°¢ [benjiyaya](https://github.com/benjiyaya) æä¾›çš„åˆå§‹ ComfyUI æ’ä»¶å®ç°ï¼Œä¸ºæˆ‘æä¾›äº†è‰¯å¥½çš„å¼€å‘åŸºç¡€ã€‚

åŒæ—¶æ„Ÿè°¢ **HeartMuLa** å›¢é˜Ÿå¼€æºäº†å¦‚æ­¤ä¼˜ç§€çš„éŸ³ä¹ç”Ÿæˆæ¨¡å‹ã€‚

*   **Based on**: [benjiyaya/HeartMuLa_ComfyUI](https://github.com/benjiyaya/HeartMuLa_ComfyUI)
*   **Original Model Repo**: [HeartMuLa/heartlib](https://github.com/HeartMuLa/heartlib)
*   **Paper**: [HeartMuLa: A Family of Open Sourced Music Foundation Models](https://arxiv.org/abs/2601.10547)
*   **Demo**: [Project Page](https://heartmula.github.io/)

### æ¨¡å‹å¼•ç”¨
*   HeartMuLa-oss-3B: https://huggingface.co/HeartMuLa/HeartMuLa-oss-3B
*   HeartCodec-oss: https://huggingface.co/HeartMuLa/HeartCodec-oss
*   HeartTranscriptor-oss: https://huggingface.co/HeartMuLa/HeartTranscriptor-oss

å¦‚æœæ‚¨è§‰å¾—æœ¬é¡¹ç›®æœ‰ç”¨ï¼Œè¯·å»åŸé¡¹ç›®ç‚¹ä¸ª Starï¼ğŸŒŸ
